#!/usr/bin/with-contenv bash

# identifies the output directory from the '--output' argument
output_dir="/downloads"

# remove cache files in the output directory and process post-processing scripts
if [ -d "$output_dir" ]; then
  echo -e "\ncleaning cache files in directory: $output_dir"

  find "$output_dir" -type f -name "*.0.jpg" -delete
  find "$output_dir" -type f -name "*.0.webp" -delete

  find "$output_dir" -type f -name "*.1.jpg" -delete
  find "$output_dir" -type f -name "*.1.webp" -delete

  find "$output_dir" -type f -name "*.2.jpg" -delete
  find "$output_dir" -type f -name "*.2.webp" -delete

  find "$output_dir" -type f -name "*.3.jpg" -delete
  find "$output_dir" -type f -name "*.3.webp" -delete

  find "$output_dir" -type f -name "*.4.jpg" -delete
  find "$output_dir" -type f -name "*.4.webp" -delete

  find "$output_dir" -type f -name "*.6.jpg" -delete
  find "$output_dir" -type f -name "*.6.webp" -delete

  find "$output_dir" -type f -name "*.7.jpg" -delete
  find "$output_dir" -type f -name "*.7.webp" -delete

  find "$output_dir" -type f -name "*.8.jpg" -delete
  find "$output_dir" -type f -name "*.8.webp" -delete

  find "$output_dir" -type f -name "*.9.jpg" -delete
  find "$output_dir" -type f -name "*.9.webp" -delete

  find "$output_dir" -type f -name "*.10.jpg" -delete
  find "$output_dir" -type f -name "*.10.webp" -delete

  find "$output_dir" -type f -name "*.11.jpg" -delete
  find "$output_dir" -type f -name "*.11.webp" -delete

  find "$output_dir" -type f -name "*.12.jpg" -delete
  find "$output_dir" -type f -name "*.12.webp" -delete

  find "$output_dir" -type f -name "*.13.jpg" -delete
  find "$output_dir" -type f -name "*.13.webp" -delete

  find "$output_dir" -type f -name "*.14.jpg" -delete
  find "$output_dir" -type f -name "*.14.webp" -delete

  find "$output_dir" -type f -name "*.15.jpg" -delete
  find "$output_dir" -type f -name "*.15.webp" -delete

  find "$output_dir" -type f -name "*.16.jpg" -delete
  find "$output_dir" -type f -name "*.16.webp" -delete

  find "$output_dir" -type f -name "*.17.jpg" -delete
  find "$output_dir" -type f -name "*.17.webp" -delete

  find "$output_dir" -type f -name "*.18.jpg" -delete
  find "$output_dir" -type f -name "*.18.webp" -delete

  find "$output_dir" -type f -name "*.19.jpg" -delete
  find "$output_dir" -type f -name "*.19.webp" -delete

  find "$output_dir" -type f -name "*.20.jpg" -delete
  find "$output_dir" -type f -name "*.20.webp" -delete

  find "$output_dir" -type f -name "*.21.jpg" -delete
  find "$output_dir" -type f -name "*.21.webp" -delete

  find "$output_dir" -type f -name "*.22.jpg" -delete
  find "$output_dir" -type f -name "*.22.webp" -delete

  find "$output_dir" -type f -name "*.23.jpg" -delete
  find "$output_dir" -type f -name "*.23.webp" -delete

  find "$output_dir" -type f -name "*.24.jpg" -delete
  find "$output_dir" -type f -name "*.24.webp" -delete

  find "$output_dir" -type f -name "*.25.jpg" -delete
  find "$output_dir" -type f -name "*.25.webp" -delete

  find "$output_dir" -type f -name "*.26.jpg" -delete
  find "$output_dir" -type f -name "*.26.webp" -delete

  find "$output_dir" -type f -name "*.27.jpg" -delete
  find "$output_dir" -type f -name "*.27.webp" -delete

  find "$output_dir" -type f -name "*.28.jpg" -delete
  find "$output_dir" -type f -name "*.28.webp" -delete

  find "$output_dir" -type f -name "*.29.jpg" -delete
  find "$output_dir" -type f -name "*.29.webp" -delete

  find "$output_dir" -type f -name "*.30.jpg" -delete
  find "$output_dir" -type f -name "*.30.webp" -delete

  find "$output_dir" -type f -name "*.31.jpg" -delete
  find "$output_dir" -type f -name "*.31.webp" -delete

  find "$output_dir" -type f -name "*.32.jpg" -delete
  find "$output_dir" -type f -name "*.32.webp" -delete

  find "$output_dir" -type f -name "*.33.jpg" -delete
  find "$output_dir" -type f -name "*.33.webp" -delete

  find "$output_dir" -type f -name "*.34.jpg" -delete
  find "$output_dir" -type f -name "*.34.webp" -delete

  find "$output_dir" -type f -name "*.35.jpg" -delete
  find "$output_dir" -type f -name "*.35.webp" -delete

  find "$output_dir" -type f -name "*.36.jpg" -delete
  find "$output_dir" -type f -name "*.36.webp" -delete

  find "$output_dir" -type f -name "*.37.jpg" -delete
  find "$output_dir" -type f -name "*.37.webp" -delete

  find "$output_dir" -type f -name "*.38.jpg" -delete
  find "$output_dir" -type f -name "*.38.webp" -delete

  find "$output_dir" -type f -name "*.39.jpg" -delete
  find "$output_dir" -type f -name "*.39.webp" -delete

  find "$output_dir" -type f -name "*.40.jpg" -delete
  find "$output_dir" -type f -name "*.40.webp" -delete

  find "$output_dir" -type f -name "*.41.jpg" -delete
  find "$output_dir" -type f -name "*.41.webp" -delete

  find "$output_dir" -type f -name "*.42.jpg" -delete
  find "$output_dir" -type f -name "*.42.webp" -delete

  find "$output_dir" -type f -name "*.43.jpg" -delete
  find "$output_dir" -type f -name "*.43.webp" -delete

  find "$output_dir" -type f -name "*.44.jpg" -delete
  find "$output_dir" -type f -name "*.44.webp" -delete

  find "$output_dir" -type f -name "*.45.jpg" -delete
  find "$output_dir" -type f -name "*.45.webp" -delete

  find "$output_dir" -type f -name "*.46.jpg" -delete
  find "$output_dir" -type f -name "*.46.webp" -delete

  find "$output_dir" -type f -name "*.47.jpg" -delete
  find "$output_dir" -type f -name "*.47.webp" -delete

  find "$output_dir" -type f -name "Songs.0.jpg" -delete
  find "$output_dir" -type f -name "Songs.1.jpg" -delete
  find "$output_dir" -type f -name "Songs.2.jpg" -delete
  find "$output_dir" -type f -name "Songs.3.jpg" -delete

  find "$output_dir" -type f -name "*Topic.0.jpg" -delete
  find "$output_dir" -type f -name "*Topic.1.jpg" -delete
  find "$output_dir" -type f -name "*Topic.2.jpg" -delete
  find "$output_dir" -type f -name "*Topic.3.jpg" -delete

  find "$output_dir" -type d -empty -delete

  find "$output_dir" -type f -name "*.5.jpg" -exec bash -c 'mv "$0" "${0%.5.jpg}.jpg"' {} \;

  # post-processing scripts

  echo -e "executing post-processing scripts for the music library update"

  sleep '3'

  python3 /app/extended-scripts/logs_cleaner.py

  sleep '3'

  python3 /app/extended-scripts/wordnet_corpus_downloader.py

  sleep '3'

  python3 /app/extended-scripts/invalid_characters_remover.py

  sleep '3'

  python3 /app/extended-scripts/complete_missing_covers.py

  sleep '3'

  python3 /app/extended-scripts/trash_collector.py

  sleep '3'

  python3 /app/extended-scripts/unofficial_albums_mover.py

  sleep '3'
  umask "$UMASK"
  exec /app/extended-scripts/loudnorm.sh

else
  echo -e "\noutput directory not found: $output_dir"
fi